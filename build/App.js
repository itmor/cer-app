!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(e);var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,a;return e=t,(r=[{key:"isHtmlElement",value:function(t){return"object"===n(t)&&null!==t}},{key:"isHtmlCollection",value:function(t){return"object"===n(t)&&void 0!==t.length&&0!==t.length}}])&&o(e.prototype,r),a&&o(e,a),t}();function i(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=new a,u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"getState",value:function(t){if(t.classList.length>2){var e,r=[],n=i(t.classList);try{for(n.s();!(e=n.n()).done;){var o=e.value;r.push(o)}}catch(t){n.e(t)}finally{n.f()}return r}return 1===t.classList.length?"disable":t.classList[1]}},{key:"getStateForAll",value:function(t){if(!c.isHtmlCollection(t))throw new Error("HTML collection was not transferred or it is empty");var e,r=[],n=i(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;r.push({element:o,state:this.getState(o)})}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"setStateForAllCerItem",value:function(t,e){if(!c.isHtmlCollection(e))throw new Error("HTML collection was not transferred or it is empty");var r,n=i(e);try{for(n.s();!(r=n.n()).done;){var o=r.value;this.setStateCerItem(t,o)}}catch(t){n.e(t)}finally{n.f()}}},{key:"setStateCerItem",value:function(t,e){if(!c.isHtmlElement(e))throw new Error("HTML element was not passed.");switch(e.className=e.classList[0],t){case"disable":break;case"active":case"not-active":e.classList.add(t);break;default:throw new Error("State ".concat(t," does not exist."))}}},{key:"setStateCerList",value:function(t,e){if(!c.isHtmlElement(e))throw new Error("HTML element was not passed.");switch(e.className=e.classList[0],t){case"disable":case"active":case"not-active":e.classList.add(t);break;default:throw new Error("State ".concat(t," does not exist."))}}},{key:"setStateContentView",value:function(t,e){if(!c.isHtmlElement(e))throw new Error("HTML element was not passed.");switch(e.className=e.classList[0],t){case"disable":break;case"empty":e.classList.add(t),e.innerText="Выберите сертификат для просмотра информации";break;case"drop":e.classList.add(t),e.innerText="Перетащите файл сертификата в это поле";break;case"filled":e.classList.add(t);break;default:throw new Error("State ".concat(t," does not exist."))}}},{key:"setStateButtonAdd",value:function(t,e){if(!c.isHtmlElement(e))throw new Error("HTML element was not passed.");switch(e.className=e.classList[0],t){case"disable":break;case"active":e.classList.add(t),e.innerText="Добавить";break;case"not-active":e.classList.add(t),e.innerText="Отменить";break;default:throw new Error("State ".concat(t," does not exist."))}}}])&&l(e.prototype,r),n&&l(e,n),t}();function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=new a,m=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"showCerItem",value:function(t,e,r){if("object"!==f(t)||"string"!=typeof t.id||"string"!=typeof t.name||!h.isHtmlElement(e))throw new Error("Error render to local storage, invalid input data");var n='\n\t            <div class="item" data-id="'.concat(t.id,'">\n\t                <span class="text">').concat(t.name,'</span>\n\t                <span class="icon">▶</span>\n\t            </div>'),o=document.createElement("DIV");o.innerHTML=n,o=o.querySelector(".item"),e.append(o),r(o)}},{key:"showContentView",value:function(t,e){if(!h.isHtmlElement(e)||"string"!=typeof t)throw new Error("Error render to local storage, invalid input data");e.innerText=t}}])&&d(e.prototype,r),n&&d(e,n),t}();function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(t,e)}(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var b=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"string"!=typeof e)throw new Error("Vault storage name is not a string");this.storageName=e}var e,r,n;return e=t,(r=[{key:"isExist",value:function(){return void 0!==localStorage[this.storageName]}},{key:"create",value:function(){if(this.isExist())throw new Error("".concat(this.storageName," already exists, first delete"));localStorage[this.storageName]="[]"}},{key:"remove",value:function(){if(!this.isExist())throw new Error("".concat(this.storageName," it was deleted before the call."));localStorage.removeItem(this.storageName)}},{key:"getData",value:function(){if(this.isExist()){var t=localStorage[this.storageName];return JSON.parse(t)}throw new Error('Unable to get data "'.concat(this.storageName,'" storage has been deleted or not yet created.'))}},{key:"getItem",value:function(t){if(this.isExist()){var e,r=localStorage[this.storageName],n=v(JSON.parse(r));try{for(n.s();!(e=n.n()).done;){var o=e.value;if(o.id===t)return o}}catch(t){n.e(t)}finally{n.f()}return"not-found"}throw new Error("Unable to get data '".concat(this.storageName,"' storage has been deleted or not yet created."))}},{key:"addItem",value:function(t){if(!this.isExist())throw new Error('Unable to get data "'.concat(this.storageName,'" storage has been deleted or not yet created.'));if("object"!==y(t)||"string"!=typeof t.id||"string"!=typeof t.name||"string"!=typeof t.content)throw new Error("Error adding item to local storage, invalid input");var e={id:t.id,name:t.name,content:t.content},r=JSON.parse(localStorage[this.storageName]);r.push(e);var n=JSON.stringify(r);localStorage[this.storageName]=n}}])&&w(e.prototype,r),n&&w(e,n),t}();function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var S=new a,C=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reHex=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/,S.isHtmlElement(e)&&S.isHtmlElement(r)&&(this.errorView=e,this.hiddenView=r)}var e,r,n;return e=t,(r=[{key:"showError",value:function(t){this.errorView.innerText=t}},{key:"parseString",value:function(t){var e=this.hiddenView.textContent;this.hiddenView.innerHTML="",this.parseData(e,t)}},{key:"parseData",value:function(t,e){var r=t,n=r.match(/commonName.*?UTF8String\s+(.*?)\s(\s\s)/)[1],o=(r=r.replace(/commonName.*?UTF8String\s+(.*?)\s(\s\s)/,"")).match(/commonName.*?UTF8String\s+(.*?)\s(\s\s)/)[1],a=r.match(/UTCTime\s(.*?)(.*?)\sUTC/)[2],i=(r=r.replace(/UTCTime\s(.*?)(.*?)\sUTC/,"")).match(/UTCTime\s(.*?)(.*?)\sUTC/)[2];e({id:Math.random().toString(36).substr(2,5),name:o,content:"Common Name: ".concat(o,"\n                      Issuer CN: ").concat(n,"\n                      Valid from: ").concat(a.split(" ")[0],"\n                      Valid till: ").concat(i.split(" ")[0])})}},{key:"decode",value:function(t,e){var r=this;this.errorView.innerText="";try{var n=window.ASN1.decode(t);if("SEQUENCE"!==n.typeName()){var o="Неверная структура конверта сертификата (ожидается SEQUENCE)";throw this.showError(o),new Error(o)}setTimeout((function(){r.hiddenView.appendChild(n.toDOM())}),0),setTimeout((function(){r.parseString(e)}),0)}catch(t){throw this.showError(t),new Error(t)}}},{key:"decodeBinaryString",value:function(t,e){var r;try{this.reHex.test(t)?r=window.Hex.decode(t):window.Base64.re.test(t)?r=window.Base64.unarmor(t):(r=t,this.decode(r,e))}catch(t){throw this.showError(t),new Error(t)}}},{key:"read",value:function(t,e){var r=this,n=new FileReader;n.onloadend=function(){n.error?r.showError("Your browser couldn't read the specified file (error code ".concat(n.error.code,").")):r.decodeBinaryString(n.result,e)},n.readAsBinaryString(t)}}])&&g(e.prototype,r),n&&g(e,n),t}();r(0);function E(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(t,e)}(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}window.addEventListener("load",(function(){(new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.localStorageName="cerApp",this.render=new m,this.stateController=new u,this.localStorageController=new b(this.localStorageName),this.rootBlock=document.querySelector("#root-app"),this.errorView=this.rootBlock.getElementsByClassName("error-view")[0],this.hiddenView=this.rootBlock.getElementsByClassName("hidden-view")[0],this.decoder=new C(this.errorView,this.hiddenView),this.buttonAdd=this.rootBlock.getElementsByClassName("btn-add")[0],this.contentView=this.rootBlock.getElementsByClassName("content-view")[0],this.cerList=this.rootBlock.getElementsByClassName("cer-list")[0],this.cerListItems=this.cerList.getElementsByClassName("item"),this.handlerStorage={buttonAdd:{handleEvent:this.buttonAddClickHandler.bind(this)},contentViewDrop:{handleEvent:this.contentViewDropHandler.bind(this)},contentViewDragover:{handleEvent:this.contentViewDragoverHandler.bind(this)},cerItem:{handleEvent:this.cerItemClickHandler.bind(this)}},this.appState={fileDropMode:!1,emptyProject:null}}var e,r,n;return e=t,(r=[{key:"start",value:function(){this.localStorageController.isExist()||this.localStorageController.create(),this.initDefaultState(),this.initApp()}},{key:"initDefaultState",value:function(){this.stateController.setStateButtonAdd("active",this.buttonAdd),this.stateController.setStateContentView("empty",this.contentView),this.stateController.setStateCerList("active",this.cerList)}},{key:"initApp",value:function(){this.addInitListeners(),this.getItemsInLocalStorage()}},{key:"getItemsInLocalStorage",value:function(){var t=this,e=this.localStorageController.getData();if(0!==e.length){this.appState.emptyProject=!1;var r,n=E(e);try{for(n.s();!(r=n.n()).done;){var o=r.value;this.render.showCerItem(o,this.cerList,(function(e){t.stateController.setStateCerItem("not-active",e),e.addEventListener("click",t.handlerStorage.cerItem)}))}}catch(t){n.e(t)}finally{n.f()}}else this.appState.emptyProject=!0,this.buttonAdd.click()}},{key:"addInitListeners",value:function(){this.buttonAdd.addEventListener("click",this.handlerStorage.buttonAdd)}},{key:"buttonAddClickHandler",value:function(){"active"===this.stateController.getState(this.buttonAdd)?(!0===this.appState.emptyProject?this.stateController.setStateCerList("disable",this.cerList):(this.stateController.setStateCerList("not-active",this.cerList),this.stateController.setStateForAllCerItem("not-active",this.cerListItems)),this.appState.fileDropMode=!0,this.stateController.setStateButtonAdd("not-active",this.buttonAdd),this.stateController.setStateContentView("drop",this.contentView),this.contentView.addEventListener("dragover",this.handlerStorage.contentViewDragover,!1),this.contentView.addEventListener("drop",this.handlerStorage.contentViewDrop,!1)):"not-active"===this.stateController.getState(this.buttonAdd)&&!1===this.appState.emptyProject&&(this.errorView.innerText="",this.stateController.setStateCerList("active",this.cerList),this.appState.fileDropMode=!1,this.stateController.setStateButtonAdd("active",this.buttonAdd),this.stateController.setStateContentView("empty",this.contentView),this.contentView.removeEventListener("dragover",this.handlerStorage.contentViewDragover,!1),this.contentView.removeEventListener("drop",this.handlerStorage.contentViewDrop,!1))}},{key:"cerItemClickHandler",value:function(t){if(!1===this.appState.fileDropMode&&"active"!==this.stateController.getState(t.currentTarget)){this.stateController.setStateForAllCerItem("not-active",this.cerListItems),this.stateController.setStateCerItem("active",t.currentTarget),this.stateController.setStateContentView("filled",this.contentView);var e=this.localStorageController.getItem(t.currentTarget.getAttribute("data-id"));this.render.showContentView(e.content,this.contentView)}}},{key:"contentViewDropHandler",value:function(t){var e=this;t.preventDefault();var r=t.dataTransfer.files[0];this.decoder.read(r,(function(t){e.localStorageController.addItem(t),e.render.showCerItem(t,e.cerList,(function(t){e.appState.emptyProject=!1,e.stateController.setStateCerList("not-active",e.cerList),e.errorView.innerText="",e.stateController.setStateCerItem("not-active",t),t.addEventListener("click",e.handlerStorage.cerItem)}))}))}},{key:"contentViewDragoverHandler",value:function(t){t.preventDefault()}}])&&L(e.prototype,r),n&&L(e,n),t}())).start()}))}]);